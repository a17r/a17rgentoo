commit bb21b93b5599596cf5901b60cbf28cfbc7a54421
Author: Andreas Sturmlechner <andreas.sturmlechner@gmail.com>
Date:   Sat Jan 21 18:26:46 2017 +0100

    Add option to disable Qt4WebKit even if present
    
    - Link against Qt4WebKit only if(HAVE_WEBKIT)
    - Remove Qt4WebKit linking from tests
    
    REVIEW: 129863

diff --git a/CMakeLists.txt b/CMakeLists.txt
index ee3d810..1acbf8a 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -48,6 +48,12 @@ set(
 )
 
 option(
+    WITH_QTWEBKIT
+    "Enable QtWebkit support"
+    ON
+)
+
+option(
     UNITY_BUILD
     "Compile multiple C++ files in one big, merged file (\"Unity build\")\nSee also http://t-fischer.dreamwidth.org/3054.html"
 )
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 04222a7..675e009 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -34,27 +34,43 @@ include(
 ##SET(CMAKE_C_FLAGS_RELWITHDEBINFO "${CMAKE_C_FLAGS_RELWITHDEBINFO} -pg")
 ##SET(CMAKE_CXX_FLAGS_DISTRIBUTION "${CMAKE_CXX_FLAGS_DISTRIBUTION} -pg")
 
-# check if QtWebKit is available, which seems to be not available
-# on e.g. RedHat Enterprise Linux 6 or Scientific Linux 6
+# check if QtWebKit support is desired and/or available
 if(
-    QT_QTWEBKIT_FOUND
+    WITH_QTWEBKIT
 )
-    message(
-        STATUS
-        "Found QtWebKit, enabling WebKit support"
+    if(
+        QT_QTWEBKIT_FOUND
+    )
+        message(
+            STATUS
+            "Found QtWebKit, enabling WebKit support"
+        )
+        add_definitions(
+            -DHAVE_QTWEBKIT
+        )
+        set(
+            OPTIONAL_QTWEBKIT_LIBRARIES
+            ${QT_QTWEBKIT_LIBRARIES}
+        )
+    else(
+        QT_QTWEBKIT_FOUND
     )
-    add_definitions(
-        -DHAVE_QTWEBKIT
+        message(
+            STATUS
+            "QtWebKit not found, disabling WebKit support"
+        )
+    endif(
+        QT_QTWEBKIT_FOUND
     )
 else(
-    QT_QTWEBKIT_FOUND
+    WITH_QTWEBKIT
 )
     message(
         STATUS
-        "QtWebKit not found, disabling WebKit support"
+        "QtWebKit support has been disabled by configuration option"
     )
 endif(
-    QT_QTWEBKIT_FOUND
+    WITH_QTWEBKIT
 )
 
 add_definitions(
diff --git a/src/networking/CMakeLists.txt b/src/networking/CMakeLists.txt
index efa14f4..fd9543f 100644
--- a/src/networking/CMakeLists.txt
+++ b/src/networking/CMakeLists.txt
@@ -131,7 +131,6 @@ target_link_libraries(
     kbibtexnetworking
     LINK_PRIVATE
     ${QT_QTCORE_LIBRARY}
-    ${QT_QTWEBKIT_LIBRARY}
     ${KDE4_KDECORE_LIBS}
     ${KDE4_KIO_LIBS}
     ${POPPLER_QT4_LIBRARIES}
diff --git a/src/program/CMakeLists.txt b/src/program/CMakeLists.txt
index a9fe213..fa57506 100644
--- a/src/program/CMakeLists.txt
+++ b/src/program/CMakeLists.txt
@@ -65,7 +65,7 @@ kde4_add_executable(
 target_link_libraries(
     kbibtex
     LINK_PRIVATE
-    ${QT_QTWEBKIT_LIBRARIES}
+    ${OPTIONAL_QTWEBKIT_LIBRARIES}
     ${KDE4_KIO_LIBS}
     ${KDE4_KPARTS_LIBS}
     ${KDE4_KFILE_LIBS}
diff --git a/src/test/CMakeLists.txt b/src/test/CMakeLists.txt
index eef0eed..4e74d75 100644
--- a/src/test/CMakeLists.txt
+++ b/src/test/CMakeLists.txt
@@ -67,7 +67,6 @@ kde4_add_unit_test(
 target_link_libraries(
     kbibtextest
     LINK_PRIVATE
-    ${QT_QTWEBKIT_LIBRARIES}
     ${KDE4_KIO_LIBS}
     ${KDE4_KPARTS_LIBS}
     ${KDE4_KFILE_LIBS}
